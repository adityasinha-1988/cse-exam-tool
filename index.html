<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUJ Exam Admin Portal</title>
    
    <style>
        /* --- CSS STYLES --- */
        :root { --primary: #e67e22; --secondary: #2c3e50; --light: #f4f6f9; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--light); display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: var(--secondary); color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .logo-area { text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .nav-item { padding: 15px; cursor: pointer; color: white; margin-bottom: 5px; border-radius: 5px; transition: 0.3s; }
        .nav-item:hover { background: #34495e; }
        .nav-item.active { background: #34495e; border-left: 5px solid var(--primary); font-weight: bold; color: var(--primary); }
        
        /* Main Content */
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & Inputs */
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; border-left: 5px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h1 { margin: 5px 0; color: var(--secondary); }
        
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 6px; width: 300px; margin-right: 10px; }
        button { padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #d35400; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; }
        .badge { padding: 5px 10px; border-radius: 10px; font-size: 11px; color: white; font-weight: bold; }
        .bg-green { background: #27ae60; } .bg-red { background: #c0392b; }

        /* Error Box */
        .error-box { background: #ffe6e6; color: #cc0000; padding: 15px; border-radius: 5px; border: 1px solid #ffcccc; display:none; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo-area">
            <h3>MUJ EXAM CELL</h3>
            <p style="font-size:12px; opacity:0.7;">Admin Console</p>
        </div>
        <div class="nav-item active" onclick="switchTab('dashboard', this)">üìä Dashboard</div>
        <div class="nav-item" onclick="switchTab('studentSearch', this)">üîç Student Search</div>
        <div class="nav-item" onclick="switchTab('facultyDuty', this)">üë®‚Äçüè´ Faculty Duties</div>
        <div class="nav-item" onclick="switchTab('roomStatus', this)">üè¢ Room Status</div>
    </div>

    <div class="main">
        
        <div id="globalError" class="error-box"></div>

        <div id="dashboard" class="section active">
            <h2>Overview Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h1 id="countStd">0</h1>
                    <p>Total Students</p>
                </div>
                <div class="stat-card">
                    <h1 id="countFac">0</h1>
                    <p>Faculty Assigned</p>
                </div>
                <div class="stat-card">
                    <h1 id="countRooms">0</h1>
                    <p>Active Rooms</p>
                </div>
            </div>
            <div class="card" style="margin-top:20px;">
                <h3>System Status</h3>
                <p id="stdStatus">‚è≥ Loading Student Data...</p>
                <p id="facStatus">‚è≥ Loading Faculty Data...</p>
            </div>
        </div>

        <div id="studentSearch" class="section">
            <h2>Find Student</h2>
            <div class="card">
                <input type="text" id="stdInput" placeholder="Enter Reg No or Name">
                <button onclick="findStudent()">Search</button>
                <div id="stdResult" style="margin-top:20px; display:none; padding:15px; background:#f9f9f9; border-radius:8px;"></div>
            </div>
        </div>

        <div id="facultyDuty" class="section">
            <h2>Faculty Duties</h2>
            <div class="card">
                <input type="text" id="facInput" placeholder="Enter Faculty Name">
                <button onclick="findFaculty()">Search Duties</button>
                <div id="facResult" style="margin-top:20px;"></div>
            </div>
            
            <div class="card" style="border-left: 5px solid #2980b9;">
                <h3>üìú Invigilator Guidelines</h3>
                <ul>
                    <li>Collect booklets 30 mins prior.</li>
                    <li>Verify Student IDs.</li>
                    <li>Report malpractice immediately.</li>
                    <li>DO NOT use mobile phones.</li>
                </ul>
            </div>
        </div>

        <div id="roomStatus" class="section">
            <h2>Room Vacancy</h2>
            <div class="card">
                <select id="filterDate"><option>Select Date</option></select>
                <select id="filterTime"><option>Select Time</option></select>
                <button onclick="checkRooms()">Check Status</button>
                <div id="roomResult" style="margin-top:20px;"></div>
            </div>
        </div>

    </div>

    <script src="student_data.js" onerror="handleError('student_data.js missing! Check filename case.')"></script>
    <script src="faculty_data.js" onerror="handleError('faculty_data.js missing! Check filename case.')"></script>

    <script>
        // GLOBAL ERROR HANDLER
        function handleError(msg) {
            const box = document.getElementById('globalError');
            box.style.display = 'block';
            box.innerHTML += `<p>‚ùå ${msg}</p>`;
        }

        // 1. Initialize Page
        window.onload = function() {
            // Check Student Data
            if (typeof studentData !== 'undefined') {
                document.getElementById('countStd').innerText = studentData.length;
                document.getElementById('stdStatus').innerHTML = '<span style="color:green">‚úî Student Data Loaded Successfully</span>';
                
                // Populate Dropdowns
                const dates = [...new Set(studentData.map(s => s.date))].filter(Boolean).sort();
                const times = [...new Set(studentData.map(s => s.time))].filter(Boolean).sort();
                const dSel = document.getElementById('filterDate');
                const tSel = document.getElementById('filterTime');
                
                dates.forEach(d => { let o = document.createElement('option'); o.value=d; o.innerText=d; dSel.appendChild(o); });
                times.forEach(t => { let o = document.createElement('option'); o.value=t; o.innerText=t; tSel.appendChild(o); });

                const rooms = new Set(studentData.map(s => s.room));
                document.getElementById('countRooms').innerText = rooms.size;

            } else {
                document.getElementById('stdStatus').innerHTML = '<span style="color:red">‚úñ Student Data Failed to Load</span>';
            }

            // Check Faculty Data
            if (typeof facultyData !== 'undefined') {
                document.getElementById('countFac').innerText = facultyData.length;
                document.getElementById('facStatus').innerHTML = '<span style="color:green">‚úî Faculty Data Loaded Successfully</span>';
            } else {
                document.getElementById('facStatus').innerHTML = '<span style="color:red">‚úñ Faculty Data Failed to Load</span>';
            }
        };

        // 2. Tab Switching Logic
        function switchTab(tabId, element) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            element.classList.add('active');
        }

        // 3. Student Search Logic
        function findStudent() {
            if (typeof studentData === 'undefined') { alert("Data not loaded!"); return; }
            const q = document.getElementById('stdInput').value.toLowerCase().trim();
            const res = document.getElementById('stdResult');
            
            if(!q) { alert("Enter Name or Reg No"); return; }
            
            const found = studentData.find(s => s.reg.includes(q) || (s.name && s.name.toLowerCase().includes(q)));
            
            if(found) {
                res.style.display = 'block';
                res.innerHTML = `
                    <h3 style="margin-top:0; color:#e67e22;">${found.name}</h3>
                    <p><strong>Reg No:</strong> ${found.reg}</p>
                    <p><strong>Exam:</strong> ${found.course} | ${found.date} | ${found.time}</p>
                    <div style="background:#2c3e50; color:white; padding:10px; border-radius:5px; margin-top:10px;">
                        Room: <strong>${found.room}</strong> &nbsp;|&nbsp; Seat: <strong>${found.seat}</strong>
                    </div>
                `;
            } else {
                res.style.display = 'block';
                res.innerHTML = `<p style="color:red; font-weight:bold;">Student Not Found!</p>`;
            }
        }

        // 4. Faculty Search Logic
        function findFaculty() {
            if (typeof facultyData === 'undefined') { alert("Data not loaded!"); return; }
            const q = document.getElementById('facInput').value.toLowerCase().trim();
            const res = document.getElementById('facResult');
            res.innerHTML = "";

            if(!q) { alert("Enter Name"); return; }

            // Partial name match logic
            const duties = facultyData.filter(f => f.name.toLowerCase().includes(q) || (f.id && f.id.toLowerCase().includes(q)));

            if(duties.length > 0) {
                let html = `<h4>Duties for: ${duties[0].name}</h4>
                <table><tr><th>Date</th><th>Time</th><th>Room</th></tr>`;
                duties.forEach(d => {
                    html += `<tr><td>${d.date}</td><td>${d.time}</td><td><strong>${d.room}</strong></td></tr>`;
                });
                res.innerHTML = html + "</table>";
            } else {
                res.innerHTML = `<p style="color:red;">No duties found.</p>`;
            }
        }

        // 5. Room Status Logic
        function checkRooms() {
            if (typeof studentData === 'undefined') return;
            const date = document.getElementById('filterDate').value;
            const time = document.getElementById('filterTime').value;
            const res = document.getElementById('roomResult');
            
            if(date === "Select Date" || time === "Select Time") { alert("Select Date & Time"); return; }

            const slotData = studentData.filter(s => s.date === date && s.time === time);
            
            let counts = {};
            slotData.forEach(s => { counts[s.room] = (counts[s.room] || 0) + 1; });

            const rooms = ["LHC 212", "LHC 213", "LHC 214", "LHC 215", "LHC 216", "LHC 217", "LHC 218"];
            const capacity = 30;

            let html = `<table><tr><th>Room</th><th>Filled</th><th>Vacancy</th><th>Status</th></tr>`;
            
            rooms.forEach(r => {
                let filled = counts[r] || 0;
                let vacant = capacity - filled;
                let badge = filled >= capacity ? '<span class="badge bg-red">FULL</span>' : (filled === 0 ? '<span class="badge" style="background:#ddd; color:#333">EMPTY</span>' : '<span class="badge bg-green">OPEN</span>');
                
                html += `<tr>
                    <td><strong>${r}</strong></td>
                    <td>${filled}</td>
                    <td style="color:${vacant>0?'green':'red'}; font-weight:bold;">${vacant}</td>
                    <td>${badge}</td>
                </tr>`;
            });

            res.innerHTML = html + "</table>";
        }
    </script>

</body>
</html>
